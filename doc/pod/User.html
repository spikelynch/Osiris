<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>../Osiris/lib/Osiris/User.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body style="background-color: white">


<!-- INDEX BEGIN -->
<div name="index">
<p><a name="__index__"></a></p>

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#methods">METHODS</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Osiris::User</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
    $user = Osiris::User-&gt;new(
        id =&gt; session('user'),
        name =&gt; $atts-&gt;{cn},
        atts =&gt; $atts,
        isisdir =&gt; $conf-&gt;{isisdir},
        basedir =&gt; $conf-&gt;{workingdir}
    );
    
    if( !$user ) {
        error(&quot;Couldn't create Osiris::User object&quot;);
        session-&gt;destroy;
        redirect '/auth/login';
    }
    
    my $jobshash = $user-&gt;jobs(reload =&gt; 1);</pre>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>A class representing a user.  It maintains the user's working
directory and list of jobs and their status, and contains their login
attributes.</p>
<p>It's also used to create new jobs.</p>
<p>
</p>
<hr />
<h1><a name="methods">METHODS</a></h1>
<dl>
<dt><strong><a name="new" class="item"><code>new(%params)</code></a></strong></dt>

<dd>
<p>Create a new user object. Parameters as follows:</p>
<dl>
<dt><strong><a name="identifier" class="item">id - the user's identifier (a hashed AAF digest, in this case)</a></strong></dt>

<dt><strong><a name="basedir_the_main_working_dir_containing_all_of_the_user_dirs" class="item">basedir - the main working dir, containing all of the user dirs</a></strong></dt>

<dt><strong><a name="isisdir_the_root_directory_of_the_isis_install" class="item">isisdir - the root directory of the Isis install</a></strong></dt>

<dt><strong><a name="mail_the_user_s_email" class="item">mail - the user's email</a></strong></dt>

<dt><strong><a name="name_the_user_s_screen_name" class="item">name - the user's screen name</a></strong></dt>

</dl>
<p>Returns undef if something goes wrong reading or creating the user's
joblist.</p>
</dd>
<dt><strong><a name="working_dir" class="item"><code>working_dir()</code></a></strong></dt>

<dd>
<p>Return this user's working dir (basedir/user_id)</p>
</dd>
<dt><strong><a name="_ensure_working_dir" class="item"><code>_ensure_working_dir()</code></a></strong></dt>

<dd>
<p>Checks if the working directory exists, and tries to create it if it 
doesn't.  If the directory exists or was created successfully, returns
1, otherwise undef.</p>
</dd>
<dt><strong><a name="jobs" class="item">jobs([ reload =&gt; 1 ])</a></strong></dt>

<dd>
<p>Returns the job list as a hashref of Osiris::Job objects keyed by ID.
The jobs will only know their status and id - to parse their XML file,
call $job-&gt;load.</p>
<p>To force a reload, pass in reload =&gt; 1</p>
</dd>
<dt><strong><a name="create_job" class="item">create_job(app =&gt; $app)</a></strong></dt>

<dd>
<p>Method used by the Dancer app to create a new job for this user.
Used to also take the uploads and parameters, but these are now added 
separately by calling add_parameters and add_input_files on the
Job.</p>
<p>Returns the Osiris::Job object if successful, undef if not.</p>
</dd>
<dt><strong><a name="write_job" class="item">write_job(job =&gt; $job)</a></strong></dt>

<dd>
<p>How the joblist and job files are updated.  Takes an Osiris::Job, calls its
write method, and then updates the job list and tries to write that.  Returns
the job if successful, undef if not.</p>
</dd>
<dt><strong><a name="_new_jobid" class="item"><code>_new_jobid()</code></a></strong></dt>

<dd>
<p>Returns a new, unique job ID</p>
</dd>
<dt><strong><a name="_joblistfile" class="item"><code>_joblistfile()</code></a></strong></dt>

<dd>
<p>Full path to the joblist file.</p>
</dd>
<dt><strong><a name="_load_joblist" class="item"><code>_load_joblist()</code></a></strong></dt>

<dd>
<p>Load the user's job list, if it exists.  Otherwise initialises the 
{jobs} member variable to an empty hashref.</p>
</dd>
<dt><strong><a name="_load_job" class="item"><code>_load_job($elt)</code></a></strong></dt>

<dd>
<p>XML::Twig handler to read a single job element</p>
</dd>
<dt><strong><a name="_save_joblist" class="item"><code>_save_joblist()</code></a></strong></dt>

<dd>
<p>Saves the job list.</p>
</dd>
<dt><strong><a name="_save_job" class="item"><code>_save_job()</code></a></strong></dt>

<dd>
<p>Returns a job as an XML element for the joblist</p>
</dd>
<dt><strong><a name="update_joblist" class="item">update_joblist( job =&gt; $job, status =&gt; $status )</a></strong></dt>

<dd>
<p>Public version of _save_joblist.  This looks the job up by id, rather
than just updating the job object, because the job list may have been
reloaded on the user betweentimes.</p>
<p>The job can be passed as an ID or an Osiris::Job.</p>
<p>This hasn't been changed drastically from when the joblist was a textfile
with just id and status - so it can't be used to modify any of the other
joblist fields.  But they shouldn't change anyway.</p>
</dd>
</dl>

</body>

</html>
